<!DOCTYPE html>
<html lang='zh-Hant'>
{% load  static %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文章比對系統</title>
  <!-- Bootstrap -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous"> -->
  <!-- Font Awesome -->
  <!-- <link
  rel="stylesheet"
  href="https://use.fontawesome.com/releases/v5.11.2/css/all.css"/> -->

  <!-- Style.css -->
  <link rel="stylesheet" href="../static/style.css">
  <!-- Favicon icon -->
  <link rel="icon" href="../static/assets/images/favicon.ico" type="image/x-icon">
  <!-- fontawesome icon -->
  <link rel="stylesheet" href="../static/assets/fonts/fontawesome/css/fontawesome-all.min.css">
  <!-- animation css -->
  <link rel="stylesheet" href="../static/assets/plugins/animation/css/animate.min.css">
  <!-- vendor css -->
  <link rel="stylesheet" href="../static/assets/css/style.css">
  <link src="../static/assets/plugins/bootstrap/css/bootstrap.min.css">
  </link>
  <link src="../static/assets/plugins/jquery-scrollbar/css/jquery.scrollbar.min.css">
  </link>
  <!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script> -->
  <!-- <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js" integrity="sha256-Lsk+CDPOzTapLoAzWW0G/WeQeViS3FMzywpzPZV8SXk=" crossorigin="anonymous"></script> -->
  <script src="../static/assets/plugins/jquery/js/jquery.min.js"></script>
  <script src="../static/assets/plugins/jquery-scrollbar/js/jquery.scrollbar.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
    integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"
    integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    img.preview {
      width: 200px;
    }

    ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    ul>li {
      display: inline-block;
      vertical-align: top;
    }

    div.progressbar {
      height: 20px;
      background-color: #e9ecef;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
      margin-bottom: 30px;
    }

    div.progressbar>span.progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      box-sizing: border-box;
      background-color: #007bff;
    }
  </style>
  <style>
    .canvasjs-chart-credit {
      display: none !important;
    }

    .h3 {
      margin-bottom: auto;
    }

    .info {
      margin-bottom: 1.23rem;
    }

    .hide {
      display: none;
    }

    .datepicker-dropdown {
      color: #000000;
      background: #ffffff;
      font-size: 14px;
    }

    .ui-datepicker-calendar {
      display: none;
    }
  </style>

  <!-- canvasjs -->
  <!-- <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script> -->
  <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.stock.min.js"></script>
  <!-- <script type="text/javascript" src="../static/assets/js/canvasjs.stock.min.js"></script> -->
  <script type="text/javascript" src="../static/stockChart.js"></script>
  <!-- 
  <script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/data.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script> -->

  <!-- canvasjs -->
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-mainbg">
    <!-- Logo -->
    <a class="navbar-brand navbar-logo" href="/stock" style="font-size: 2rem;"><b>文章比對系統</b></a>
    <!-- Collapse Button -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars text-white"></i>
    </button>
    <!-- Links -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        <!-- For Styling -->
        <div class="hori-selector">
          <div class="left"></div>
          <div class="right"></div>
        </div>
        <!-- Nav Links -->
        <li class="nav-item active">
          <a class="nav-link" href="../stock">
            <i class="far fa-copy">
            </i>主頁
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">
            <i class="far fa-chart-bar">
            </i>其他..
          </a>
        </li>

      </ul>
    </div>
  </nav>


  <div class="app">

    <div class="row" style="margin-top: 1rem;margin-right: auto;margin-left: auto;">
      <div class="col-12">
        <!-- <h3 id="top" class="text-center " style="font-size: 35px;">請輸入股票代號或股票名稱</h3> -->

        <!-- <form id="form" enctype="multipart/form-data">
          <input type="file" id="the_file" accept=".txt">
          <ul class="picture_list"></ul>
          <input type="file" id="fileAttach" name="file" accept=".txt" />
          <input type="button" onclick="upload()" value="上傳" />
        </form> -->
        <form class="form-row">
          <div class="form-inline col-lg-6 align-items-center justify-content-center">
            <div class="form-group mr-3 mb-1 ">
              <label class="col-auto mr-0">
                <h4 class="my-auto" style="color:#888"><b>附件:</b></h4>
              </label>
              <input id="myfile" type="file" style="display: none" enctype="multipart/form-data" accept=".txt">
              <!-- 增加多檔案 -->
              <!--显示上传的文件名字-->
              <input type="text" id="FileCover" class="form-control" readonly="true" size=50%
                ondragover="dragHandler(event);" ondragleave="dragOut(event);" ondrop="drop_image(event);"
                placeholder="拖拉檔案或點選瀏覽" style="">
            </div>
            <div class="form-inline mr-3  mb-1">
              <button class="btn btn-primary my-auto mr-2 mr-0 " style="display:block;" type="button"
                onclick="$('input[id=myfile]').click();">
                <i class="fa fa-folder-open" id="browse">&nbsp;&nbsp;瀏覽</i>
              </button>

              <button class="btn btn-success  my-auto  mr-0" type="button" onclick="MyUpload()">
                <i class="fa fa-paper-plane" id="upload_status">&nbsp;&nbsp;上傳</i>
              </button>
            </div>
          </div>
          <div class="col-lg-6 align-items-center justify-content-center" id="show_upload">
            <!-- <div class="row">
              <div id="backname" class="col-lg-9">文件1</div>
              <div id="backurl" style="display: none"></div>
              <div class="col-lg-3">
                <div class="row">
                  <div class="col-8 text-right">上傳進度:</div>
                  <div class="col-4 text-right" id="percentage">100%</div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
            <div class="progress">
              <div id="percentagebar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>
            </div> -->
          </div>
        </form>


        <script>
          var filename = '';
          function getCookie(name) {
            var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
            return r ? r[1] : undefined;
          }

          function dragHandler(e) {
            e.preventDefault(); //防止瀏覽器執行預設動作
            // console.log("dragHandler")
            $("#FileCover").css({
              "border-color": "#04a9f5",
              "border-width": "3px",
              "border-style": "dotted"
            });

          }

          function dragOut(e) {
            e.preventDefault(); //防止瀏覽器執行預設動作
            $("#FileCover").css({
              "border-color": "",
              "border-width": "",
              "border-style": ""
            });

          }

          var myfiles = null

          function drop_image(e) {

            e.preventDefault(); //防止瀏覽器執行預設動作

            myfiles = e.dataTransfer.files; //擷取拖曳的檔案
            var file_index = 0;
            var file_len = myfiles.length;
            var myfilename = "";
            while (file_index < file_len) {
              if (!myfiles[file_index].type.match('text')) {
                var name = myfiles[file_index].name;
                alert(name + ' 無法上傳！請拖曳文字檔案！');
                break;
              }
              myfilename = myfilename + myfiles[file_index].name + "；";
              file_index = file_index + 1;

            }
            // console.log(files)
            $('#FileCover').val(myfilename);


            /* 把擷取到的檔案用POST送到後端去 */
          }
          $('input[id=myfile]').change(function () {
            myfiles = document.getElementById("myfile").files;
            var file_index = 0;
            var file_len = myfiles.length;
            var myfilename = "";
            while (file_index < file_len) {
              myfilename = myfilename + myfiles[file_index].name + "；";
              file_index = file_index + 1;
            }
            //console.log(myfiles);
            //$('#FileCover').val($(this).val());
            $('#FileCover').val(myfilename);
            //拼接上传的文件名字并返回到FileCover
          })

          function MyUpload() {
            // myfiles = document.getElementById("myfile").files; //获取文件
            var totalfile = myfiles.length; //上传的文件个数
            var uploadedfile = 0; //已上传的文件个数
            var formdata = new FormData(); //构建FormData用于Ajax发送
            var file_index = 0;
            //每上传一个文件，添加一个进度条
            // var addhtml = " <div id=\"backname\" class=\"col-sm-9\">文件1</div>\n" +
            //   "                                    <div id=\"backurl\" style=\"display: none\"></div>\n" +
            //   "                                    <div class=\"col-sm-2\">上传进度:</div>\n" +
            //   "                                    <div id=\"percentage\" class=\"col-sm-1\">100%</div>\n" +
            //   "                                    <div class=\"clearfix\"></div>\n" +
            //   "                                    <div class=\"progress progress-small\" >\n" +
            //   "                                        <div id=\"percentagebar\" style=\"width:0%;\" class=\"progress-bar progress-bar-success \"></div>\n" +
            //   "                                    </div> ";
            var addhtml = '<div class="row">\
              <div id="backname" class="col-lg-9">文件1</div>\
              <div id="backurl" style="display: none"></div>\
              <div class="col-lg-3">\
                <div class="row">\
                  <div class="col-8 text-right">上傳進度:</div>\
                  <div class="col-4 text-right" id="percentage">100%</div>\
                </div>\
              </div>\
            </div>\
            <div class="clearfix"></div>\
            <div class="progress mt-1">\
              <div id="percentagebar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"\
                aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>\
            </div>'



            $("#show_upload").empty(); //每次点击上传按钮，把所有的进度条清空
            while (file_index < myfiles.length) {
              if (!myfiles[file_index].type.match('text')) {
                var name = myfiles[file_index].name;
                alert(name + ' 無法上傳！請拖曳文字檔案！');
                break;
              }
              formdata.append('file', myfiles[file_index]); // 获取1个文件放入FormData中
              var percentage = null; //上传进度

              $.ajax({
                headers: {
                  "X-CSRFToken": getCookie("csrftoken")
                },
                type: "POST",
                url: "/project/",
                data: formdata,
                processData: false, // 告诉jQuery不要处理数据
                contentType: false, // 告诉jQuery不要设置类型
                // dataType: "json",
                xhr: function xhr() {
                  var newbackname = "backname" + file_index; //文件名，本来想写后台返回的，懒
                  var newbackurl = "backurl" + file_index; //每个文件上传后，返回的前台访问的url
                  var newp = "percentage" + file_index; //每个文件的进度
                  var newpbar = "percentagebar" + file_index; //每个进度条的名字
                  var myfilename = myfiles[file_index].name;

                  $("#show_upload").append(addhtml);
                  $("#backname").attr('id', newbackname);
                  $("#backurl").attr('id', newbackurl);
                  $("#percentage").attr('id', newp);
                  $("#percentagebar").attr('id', newpbar);

                  var myxhr = $.ajaxSettings.xhr();
                  if (myxhr.upload) {
                    myxhr.upload.addEventListener('progress', function (e) {
                      if (e.lengthComputable) {
                        percentage = parseInt(e.loaded / e.total * 100);
                        var now_percentage = percentage + "%";
                        $("#" + newp).html(now_percentage);
                        $("#" + newpbar).css({
                          "width": now_percentage
                        });
                        $("#" + newbackname).html(myfilename);
                        if (percentage == 100) {
                          // var classVal = document.getElementById("percentagebar").getAttribute("class");
                          // classVal = classVal.replace("progress-bar-animated", "");
                          // document.getElementById("percentagebar").setAttribute("class", classVal);
                          document.getElementById(newpbar).classList.remove("progress-bar-animated");
                        }
                      }
                    }, false);
                  }
                  return myxhr;
                },
                success: function (result) {
                  console.log(result)
                  //每次上传完毕后得到返回值，取出返回的json值
                  filename = result.FileName; //后台返回新的文件名
                  document.getElementById("real_search_time").innerHTML =  new Date()
                  document.getElementById("code").innerHTML = filename
                  // var fileurl = result.FileUrl; //后台返回的文件url
                  uploadedfile = uploadedfile + 1;
                  if (uploadedfile == totalfile) {
                    $("#upload_status").text("   重新上傳");
                    alert("檔案上傳完畢！");
                  }
                }
              });
              file_index = file_index + 1;
            }
          }
        </script>
        <!-- <input type="file" id="the_file" accept="image/*" multiple>
        <ul class="picture_list"></ul> -->
        <!-- <div class="progressbar">
        <span class="progress" style="width: 0%;"></span>
      </div> -->

      </div>
      <!-- <script>
        function dragHandler(e) {
          e.preventDefault(); //防止瀏覽器執行預設動作
          // console.log("dragHandler")

        }

        function drop_image(e) {
          e.preventDefault(); //防止瀏覽器執行預設動作

          var files = e.dataTransfer.files; //擷取拖曳的檔案
          console.log(files)

          /* 把擷取到的檔案用POST送到後端去 */
          var files = e.dataTransfer.files;
          var formdata = new FormData();
          for (var i = 0; i < files.length; i++) // 把檔案加入表單中
          {
            if (!files[i].type.match('text')) {
              var name = files[i].name;
              alert(name + ' 無法上傳！請拖曳文字檔案！');
              continue;
            }

            formdata.append('file', files[i]);
          }

          XMLHttpRequest.upload.onprogress = function (e) //上傳中
          {
            if (e.lengthComputable) {
              var intComplete = (e.loaded / e.total) * 100 | 0;

              elProgress.innerHTML = intComplete + '%'; // 控制進度條的顯示數字，例如65%

              elProgress.style.width = intComplete + '%'; // 控制進度條的長度


              elProgress.setAttribute('aria-valuenow', intComplete);
            }
          }
          // objXhr.onload = function (e) //上傳完成時
          // {
          //   /*接收後端傳回的Response，本範例的後端程式會傳回每個圖檔是否都上傳成功，以及上傳成功的圖片數量*/
          //   var arrData = JSON.parse(objXhr.responseText);

          //   for (var i = 0; i < arrData.length; i++) // 檢查每個圖檔上傳成功或是失敗，成功上傳者顯示在頁面上

          //   {
          //     var img = new Image();
          //     img.src = arrData[i].url;
          //     img.className = 'image';
          //     images_container.appendChild(img);
          //   }
          // }
        }
      </script>
      <script>
        window.addEventListener("DOMContentLoaded", function () {

          var the_file_element = document.getElementById("the_file");
          the_file_element.addEventListener("change", function (e) {

            var picture_list = document.getElementsByClassName("picture_list")[0];
            picture_list.innerHTML = ""; // 清空

            var that = this; // 將 this 用 that 來替代，底下程式會用到

            // 跑每個使用者選的檔案
            for (let i = 0; i < this.files.length; i++) {

              let reader = new FileReader(); // 用來讀取檔案

              reader.readAsDataURL(this.files[i]); // 讀取檔案

              reader.addEventListener("load", function (e) {
                console.log("load 事件");
                console.log(e);

                // 建立 li 標籤，加上屬性、圖片、進度條，最後放入 ul 標籤裡
                let li_html = `
                  <li data-index="${i}">
                    <img class="preview" src="${reader.result}">
                    <div class="progress text-center">
                      <div id="upload_progress" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow=""
                        aria-valuemin="0" aria-valuemax="100">
                      </div>
                    </div>
                    <div class="progressbar"><span class="progress" style="width: 0%;"></span></div>
                  </li>
                `;
                picture_list.insertAdjacentHTML("beforeend", li_html); // 加進節點

                function getCookie(name) {
                  var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
                  return r ? r[1] : undefined;
                }
                var formdata = new FormData();
                //ajax上傳文件的時候， 需要這個類型， 它會將添加的鍵值對加工成formata的類型
                // formdata.append('uname', $('#name').val());
                //添加鍵值對的方法是append， 注意寫法， 鍵和值之間使用逗號隔開
                // formdata.append('file', $('input[type=file]')[0].files[0]);
                formdata.append('file', that.files[i]);
                $.ajax({
                  headers: {
                    "X-CSRFToken": getCookie("csrftoken")
                  },
                  url: "/stock/",
                  type: "POST",
                  data: formdata,
                  contentType: false,
                  cache: false,
                  processData: false,

                  xhr: function () {
                    //console.log("這是第幾個索引：" + i);
                    var myXhr = $.ajaxSettings.xhr();
                    if (myXhr.upload) {
                      myXhr.upload.addEventListener('progress', function (evt) {
                        //console.log("progress 事件觸發");
                        // 註：nth-child 是從 1 開始
                        var progress_el = document.querySelector(".picture_list li:nth-child(" + (
                          i + 1) + ") span.progress");

                        if (evt.lengthComputable) {
                          var loaded = (evt.loaded / evt.total);
                          if (loaded <= 1) {
                            console.log(evt.loaded / evt.total)
                            var percent = loaded * 100;
                            console.log("進度：" + percent + "%");

                            // 改變介面進度條的百分比
                            progress_el.setAttribute("style", "width: " + percent + "%;");

                            var intComplete = (evt.loaded / evt.total) * 100 | 0;

                            elProgress.innerHTML = intComplete + '%'; // 控制進度條的顯示數字，例如65%

                            elProgress.style.width = intComplete + '%'; // 控制進度條的長度


                            elProgress.setAttribute('aria-valuenow', intComplete);
                          }
                        }

                      }, false);
                    }
                    return myXhr;
                  },

                  success: function (data_obj) { // 從伺服器回傳的資料
                    //console.log("success");
                    alert("傳送完成");
                    console.log(data_obj);

                  }
                });


              });


            }

          });
        });
      </script> -->
      <!-- <script>
        function getCookie(name) {
          var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
          return r ? r[1] : undefined;
        }

        function upload() {
          var formdata = new FormData();
          //ajax上傳文件的時候， 需要這個類型， 它會將添加的鍵值對加工成formata的類型
          // formdata.append('uname', $('#name').val());
          //添加鍵值對的方法是append， 注意寫法， 鍵和值之間使用逗號隔開
          formdata.append('file', $('input[type=file]')[0].files[0]);
          $.ajax({
            headers: {
              "X-CSRFToken": getCookie("csrftoken")
            },
            url: "/stock/",
            type: "post",
            data: formdata,
            cache: false,
            processData: false,
            contentType: false,
            success: function (respone) {
              console.log(respone)
              // if (data.res == "400") {
              //     $("#upload-result").text("传成功");
              //     $("#imgdiv").html("<img src=\"upload/"+data.path+"\"/>");
              // }else if (data.res == "403") {
              //     $("#upload-result").text("格式不对");
              // }else if (data.res == "404") {
              //     $("#upload-result").text("上传错误");
              // }

            },
            error: function (data) {
              alert("上傳失敗")
            }
          })
        }
      </script> -->
      <div class="col-12 col-lg-6 align-items-center" style="margin-top: 1rem;">

        <div class="card card-social" id="information">
          <div class="card-header">
            <h5><b>上傳檔案資訊</b></h5>
          </div>

          <div class="card-block border-bottom">
            <h3 class="info" ><b>上傳時間：</b><span id="real_search_time">{{ real_search_time }}</span></h3>
            <h3 class="info"><b>檔案名稱：</b><span id="code">{{ code }}</span></h3>
            <h3 class="info"><b>Top20關鍵字：</b><span id="top20" style="line-height: 42px;">{{ name }}</span></h3>
            <!-- <h3 class="info"><b>其他：</b><span id="fullname">{{ fullname }}</span></h3> -->
            <!-- <i class="feather icon-alert-circle text-c-blue f-50" style="margin-top: 5 rem;"></i> -->
          </div>
          <div class="card-block">
            <div class="row align-items-center justify-content-center card-active">
              <!-- <div class="col-4">
                <h3 class="text-center m-b-20"><span class="m-r-5" style="font-size: 32px;"><b>關鍵字</b></span></h4>
                  <div class="row d-flex align-items-center justify-content-center">
                    <div class="f-w-300 d-flex m-b-0">

                      <i class="fa fa-bell text-c-yellow f-30 m-r-10"></i>
                      <h3 class="h3" id='open'>NT$ {{ open }}</h3>
                    </div>
                  </div>
              </div> -->
              <div class="col-6">
                <h3 class="text-center m-b-20"><span class="m-r-5" style="font-size: 32px;" ><b>關鍵字</b></span></h4>
                  <div class="row d-flex align-items-center justify-content-center">
                    <div class="f-w-300 d-flex m-b-0">

                      <i class="fas fa-trophy text-c-yellow f-30 m-r-10"></i>
                      <h3 class="h3" id="top"></h3>
                    </div>

                  </div>

              </div>
              <div class="col-6">
                <h3 class="text-center m-b-20"><span class="m-r-5" style="font-size: 32px;" ><b>關鍵字出現次數</b></span></h4>
                  <div class="row d-flex align-items-center justify-content-center">
                    <div class="f-w-300 d-flex m-b-0">

                      <i class="fas fa-file-word text-c-blue f-30 m-r-10"></i>
                      <h3 class="h3" id="topCount"></h3>
                    </div>

                  </div>

              </div>
            </div>

          </div>
        </div>
        <div class="card card-social">
          <div class="card-block  border-bottom mt-3">
            <div class="" id="chartContainer" style="height: 450px; width: 100%;"></div>
            <img id="loader"
              src="https://canvasjs.com/wp-content/uploads/images/gallery/javascript-stockcharts/overview/loading.gif"
              style="position: absolute; top: 50%; left: 50%;transform: translate(-50%, 50%) ;display: none" />

          </div>


          <!-- <div class="card-block border-bottom">
            <div class="row align-items-center justify-content-center card-active">
              <div class="col-6">
                <h3 class="text-center m-b-20"><span class="m-r-5" style="font-size: 32px;"><b>最佳買入</b></span></h4>
                  <div class="row align-items-center justify-content-center">
                    <div class="col-auto" style="margin-left: 1.5rem;">
                      <i class="fa fa-shopping-cart text-c-green f-36"></i>
                    </div>
                    <div class="col text-left" style="padding-left: 10px;">
                      <h4>價格：<span class="text-muted" id='best_bid_price'>
                          {% for i in best_bid_price%}
                          {%if forloop.last %}{{i}} {%else%} {{i}}, {%endif%}
                          {% endfor %}</span></h4>
                      <h4 class="text-c-black mb-0">數量：<span class="text-muted" id="best_bid_volume">
                          {% for i in best_bid_volume%}
                          {%if forloop.last %}{{i}} {%else%} {{i}}, {%endif%}
                          {% endfor %}
                        </span></h4>
                    </div>
                  </div>
              </div>
              <div class="col-6">
                <h3 class="text-center  m-b-20"><span class="m-r-5" style="font-size: 32px;"><b>最佳賣出</b></span></h4>

                  <div class="row align-items-center justify-content-center">
                    <div class="col-auto" style="margin-left: 1.5rem;">
                      <i class="fa fa-money-bill-alt text-c-red f-36"></i>
                    </div>
                    <div class="col text-left" style="padding-left: 10px;">
                      <h4>價格：<span class="text-muted" id="best_ask_price">
                          {% for i in best_ask_price%}
                          {%if forloop.last %}{{i}} {%else%} {{i}}, {%endif%}
                          {% endfor %}
                        </span></h4>
                      <h4 class="text-c-black mb-0">數量：<span class="text-muted" id="best_ask_volume">
                          {% for i in best_ask_volume%}
                          {%if forloop.last %}{{i}} {%else%} {{i}}, {%endif%}
                          {% endfor %}
                        </span></h4>
                    </div>
                  </div>
              </div>
            </div>
          </div> -->
        </div>
      </div>

      <div class="col-12 col-lg-6 " style="margin-top: 1rem;">
        <div class="card ">
          <div class="card-header">
            <h5><b>文章相似網站排序</b></h5>
          </div>
          <div class="card-block  border-bottom">

            <form class="" id='chartForm' enctype="multipart/form-data">
              {%csrf_token%}
              <div class="form-inline ">
                <div class="form-row">
                  <div class="col-auto mb-3 mr-3">
                    <label class="mb-1 mr-2" for="" style="display:block;">請選擇搜尋引擎</label>
                    <select class="form-control mr-2" id='open_stock_code' name="open_stock_code"
                      style="margin-bottom: 0.5rem;width: 160px;" required>
                      <option selected value>Choose...</option>
                      <option value="google">Google</option>

                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="col-auto mb-3 mr-3">
                    <label class="mb-1 mr-2" for="" style="display:block;" name="open_type">請選擇搜尋頁數</label>
                    <select class="form-control" id="select" name="select" style="margin-bottom: 0.5rem;" required>
                      <option selected value>Choose...</option>
                      <option value="1">1頁</option>
                      <option value="3">3頁</option>
                      <option value="5">5頁</option>
                      <option value="7">7頁</option>
                      <option value="10">10頁</option>
                    </select>
                    <!-- TODO 做js 或 py分析日期 / - -->
                  </div>

                </div>
                <div class="col text-right">
                  <!-- <i class="fas fa-clipboard-list  f-50 "></i> -->
                  <i class="feather icon-alert-circle  f-50"></i>
                </div>

              </div>
              <div class="form-inline ">
                <div class="col-10" id="cal"></div>
                <div class="col-2">
                  <label class="mb-1" for="" style="display:block;">&ensp;</label>
                  <button type="submit" class="btn btn-primary my-auto">Submit</button>
                </div>


              </div>


            </form>
            <div class="mt-3">
              <!-- <div class="" id="chartContainer" style="height: 450px; width: 100%;"></div>
              <img id="loader"
                src="https://canvasjs.com/wp-content/uploads/images/gallery/javascript-stockcharts/overview/loading.gif"
                style="position: absolute; top: 50%; left: 50%;transform: translate(-50%, 50%) ;display: none" /> -->

            </div>
            <script>
              // $(document).ready(function(){
              //     $.ajaxSetup({
              //         data: {csrftoken: '{{csrf_token }}' },
              //     });
              //   });
              // var resetCanvas = function(){
              //   $('#chartContainer').remove(); // this is my <canvas> element
              //   $('#graph-container').html('<div class="mt-3" id="chartContainer" style="height: 450px; width: 100%;"></div>');
              //   // $("#visualize").width(300).height(150);
              // };
              var tableContent = '<tr>\
                      <td>\
                        <h6 class="m-0" id="tdNum"></h6>\
                      </td>\
                      <td>\
                        <a id="tdWebsite" href=""><h6 class="m-0 text-center text-c-blue" id="tdWebsiteTXT" ></h6></a>\
                      </td>\
                      <td>\
                        <h6 class="m-0 text-center text-c-black" id="tdScorce"></h6>\
                      </td>\
                      <td class="text-right"><i class="fas fa-circle f-10" id="tdColoer"></i></td>\
                    </tr>'
              function setColor(scorce) {
                if(scorce>=60.0){
                  return "#dc3545"
                }else if(scorce<60.0 && scorce>=30.0){
                  return "#ffc107"
                }else{
                  return "#52E99E" 

                }
              }    
              function getCookie(name) {
                var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
                return r ? r[1] : undefined;
              }
              $('#chartForm').on('submit', function (event) {

                // resetCanvas(); //清除舊圖
                // $.post('/url/', $(this).serialize(), function (data) {
                //   $('.message').html(data.message);
                //   // of course you can do something more fancy with your respone
                // });
                // event.preventDefault();
                if(filename == ''){
                  alert("⚠請上傳檔案⚠");
                  // location.reload();
                }
                var formdata = new FormData();
                // formdata.append('open_stock_code',$("#open_stock_code").val());
                // formdata.append('year',$("#years").val());

                // console.log(formdata.get('year'));
                // if ($('#select').val() == 'year') {
                //   formdata.append('open_stock_code', $("#open_stock_code").val());
                //   formdata.append('month', $("#months").val());
                //   formdata.append('year', $("#years").val());
                // } else if ($('#select').val() == 'month') {
                //   formdata.append('open_stock_code', $("#open_stock_code").val());
                //   formdata.append('month', $("#months").val());
                //   // console.log(formdata.get('month'));
                // }
                formdata.append('open_stock_code', $("#open_stock_code").val());
                formdata.append('select', $("#select").val());
                formdata.append('whiteList', $("#whiteList").val());
                $.ajax({
                  headers: {
                    "X-CSRFToken": getCookie("csrftoken")
                  },
                  url: '/project/',
                  type: 'post',
                  async: true,
                  processData: false, //告诉jQuery不要去处理发送的数据
                  contentType: false, // 告诉jQuery不要去设置Content-Type请求头
                  data: formdata,
                  success: function (data) {
                    if(!data["null"]){
                      alert("分析完成😉!!");
                    }
                    // console.log(data[filename.split('.')[0]])
                    console.log(data)

                    var jsonArray = []
                    for(var key in data[filename.split('.')[0]]){
                      var Json = {}
                      Json["website"] = key
                      Json["scorce"] = data[filename.split('.')[0]][key]
                      jsonArray.push(Json)
                    }
                    
                    // console.log(jsonArray)

                    jsonArray.sort(function(a, b){
                        return b.scorce - a.scorce;
                    });//降序
                    
                    // jsonArray.sort(function (a, b) {
                    //   return a.name.localeCompare(b.name)
                    // });
                    console.log(jsonArray)
                    // console.log(data)

                    // year_day=[]
                    // year_open=[]
                    // year_high=[]
                    // year_low=[]
                    // year_close=[]
                    // console.log(data.year_day[0]);
                    // data.filename[0]

                    stockChart.options.data[0].dataPoints = [];
                    // console.log(stockChart.options.navigator.data[0].dataPoints);
      
                    // console.log(stockChart.options.title.text);
                    var stockDict = {
                      "google": "Google搜尋引擎比結果",
                    }
                    stockChart.options.title.text = stockDict[$("#open_stock_code").val()]
                    // stockChart.option.title.text = $("#open_stock_code").val();
                    // = [];
                    // console.log(stockChart.options.charts[0]);
                    // stockChart.options.charts[0].data[0].dataPoints = [];

                    for (var i = 0; i < jsonArray.length; i++) {
                      stockChart.options.data[0].dataPoints.unshift({
                        
                        y: Number(jsonArray[i]["scorce"]),
                        // label: jsonArray[i]["website"],
                        label: (i+1),
                        color: setColor(jsonArray[i]["scorce"])
                      });
                    }
                    // console.log(dataPoints1);
                    // console.log(dataPoints2);

                    $("#loader").css("display", "none");
                    stockChart.render();

                    // stockChart.update();

                    // var tableContent = '<tr><td><h6 class="m-0" id="' + (i+1) + '">' + i + '</h6></td>'+\
                    //   '<td>
                    //     <h6 class="m-0 text-center text-c-red">Missed</h6>\
                    //   </td>\
                    //   <td>\
                    //     <h6 class="m-0 text-center text-c-red">Missed</h6>\
                    //   </td>\
                    //   <td class="text-right"><i class="fas fa-circle text-c-red f-10"></i></td>\
                    // </tr>'
                   

                    for (var i = 0; i < jsonArray.length; i++) {
                      $("#tableBody").append(tableContent);

                      $("#tdNum").attr('id', 'tdNum'+(i+1));
                      document.getElementById('tdNum'+(i+1)).innerHTML = (i+1);

                      
                      // $("#tda").attr('herf', jsonArray[i]["website"]);
                      // $("#tda").attr('id', 'tda'+(i+1));
                      $("#tdWebsite").attr('href', jsonArray[i]["website"]);
                      $("#tdWebsite").attr('id', 'tdWebsite'+(i+1));
                      // document.getElementById('tdWebsite'+(i+1)).innerHTML = jsonArray[i]["website"];

                      $("#tdWebsiteTXT").attr('id', 'tdWebsiteTXT'+(i+1));
                      document.getElementById('tdWebsiteTXT'+(i+1)).innerHTML = jsonArray[i]["website"];

                      $("#tdScorce").attr('id', 'tdScorce'+(i+1));
                      document.getElementById('tdScorce'+(i+1)).innerHTML = jsonArray[i]["scorce"];

                      $("#tdColoer").attr('id', 'tdColoer'+(i+1));
                      if(jsonArray[i]["scorce"]>=60.0){
                        $("#"+'tdColoer'+(i+1)).addClass("text-c-red");
                      }else if(jsonArray[i]["scorce"]<60.0 && jsonArray[i]["scorce"]>=30.0){
                        $("#"+'tdColoer'+(i+1)).addClass("text-c-yellow");
                      }else{
                        $("#"+'tdColoer'+(i+1)).addClass("text-c-green");
                      }
                      

                    }
                    document.getElementById("top").innerHTML =  data["Top"];
                    document.getElementById('topCount').innerHTML = data["TopCount"];
                    document.getElementById('top20').innerHTML = data["Top20"].join();


                  },
                  error: function (XMLHttpRequest, textStatus, errorThrown) {
                    var status = {
                      204: "無內容",
                      301: "要求的網頁已經永久改變網址",
                      302: "物件已移動",
                      304: "未修改",
                      400: "錯誤的要求",
                      401: "拒絕存取",
                      403: "禁止使用",
                      404: "找不到",
                      405: "方法不受允許",
                      407: "需要 Proxy 驗證",
                      500: "內部伺服器錯誤",
                      503: "服務無法使用",
                      504: "閘道逾時",
                      505: "不支援的 HTTP 版本",
                    }

                    alert("HTTP狀態 " + XMLHttpRequest.status + "：" + status[XMLHttpRequest.status] +
                      "\n請通知聯絡人員處理!");
                    // alert("哈哈 你被Ban掉了! 好爛");
                    // alert(XMLHttpRequest.readyState);
                    // alert(textStatus);
                    // alert("超時請求")
                  },
                });
                // dataPoints1 = []
                // dataPoints2 = []
                event.preventDefault();
              });
              // $('#search_stock').on('submit', function (event) {

              //   var formdata = new FormData();

              //   formdata.append('stock_name', $("#stock_name").val());
              //   // console.log(formdata.get('stock_name'));

              //   $.ajax({
              //     headers: {
              //       "X-CSRFToken": getCookie("csrftoken")
              //     },
              //     url: '/stock/',
              //     type: 'POST',
              //     async: false,
              //     // timeout: 50,
              //     processData: false, //告诉jQuery不要去处理发送的数据
              //     contentType: false, // 告诉jQuery不要去设置Content-Type请求头
              //     data: formdata,
              //     success: function (data) {
              //       // console.log(data.message)
              //       // console.log($('#low').html().replace(/<.*>*<.*>|\s/g,"")); 
              //       // console.log($('#low').children()); 
              //       // document.getElementById("low").innerHTML=$('#low').children()
              //       // console.log(document.getElementById("low").innerHTML);
              //       // document.getElementById("low").innerText=data.message
              //       // $('#low').html().replace(/<.*>*<.*>|\s/g,"NT$"+data.message)
              //       // console.log($("#low").contents().filter(function(){ 
              //       //   return this.nodeType == 3; 
              //       // })[1].nodeValue);
              //       // $("#low").contents().filter(function(){ 
              //       //   return this.nodeType == 3; 
              //       // })[1].nodeValue = 'NT$ '+data.message
              //       // $('#low').text()=data.message


              //       // best_ask_price: (5)["573", "574", "575", "576", "577"]
              //       // best_ask_volume: (5)["405", "484", "1163", "712", "1307"]
              //       // best_bid_price: (5)["572", "571", "570", "569", "568"]
              //       // best_bid_volume: (5)["310", "173", "172", "310", "497"]
              //       // code: "2330"
              //       // fullname: "台灣積體電路製造股份有限公司"
              //       // high: "577"
              //       // low: "568"
              //       // name: "台積電"
              //       // open: "572"
              //       // real_search_time: "2021-05-21 14:30:00"

              //       // console.log(data['eror']==undefined);
              //       // console.log(data);
              //       // console.log(data.best_ask_price);
              //       if (data['error'] == undefined) {
              //         document.getElementById("real_search_time").innerHTML = data.real_search_time
              //         document.getElementById("code").innerHTML = data.code
              //         document.getElementById("name").innerHTML = data.name
              //         document.getElementById("fullname").innerHTML = data.fullname
              //         document.getElementById("open").innerHTML = "NT$ " + data.open
              //         document.getElementById("high").innerHTML = "NT$ " + data.high
              //         document.getElementById("low").innerHTML = "NT$ " + data.low
              //         document.getElementById("best_bid_price").innerHTML = data.best_bid_price
              //         document.getElementById("best_bid_volume").innerHTML = data.best_bid_volume
              //         document.getElementById("best_ask_price").innerHTML = data.best_ask_price
              //         document.getElementById("best_ask_volume").innerHTML = data.best_ask_volume
              //       } else if (data['error'] == 'stockInfoError') {
              //         alert("伺服器暫時被禁止\n請稍後再試!");
              //       } else {
              //         // console.log(data['error']+);
              //         alert("伺服器暫出現未知錯誤\n請通知聯絡人員處理!");
              //       }

              //       // {% for i in best_ask_volume%}
              //       //       {%if forloop.last %}{{i}} {%else%} {{i}}, {%endif%}
              //       //       {% endfor %}

              //     },
              //     error: function (XMLHttpRequest, textStatus, errorThrown) {
              //       var status = {
              //         204: "無內容",
              //         301: "要求的網頁已經永久改變網址",
              //         302: "物件已移動",
              //         304: "未修改",
              //         400: "錯誤的要求",
              //         401: "拒絕存取",
              //         403: "禁止使用",
              //         404: "找不到",
              //         405: "方法不受允許",
              //         407: "需要 Proxy 驗證",
              //         500: "內部伺服器錯誤",
              //         503: "服務無法使用",
              //         504: "閘道逾時",
              //         505: "不支援的 HTTP 版本",
              //       }

              //       alert("HTTP狀態 " + XMLHttpRequest.status + "：" + status[XMLHttpRequest.status] +
              //         "\n請通知聯絡人員處理!");
              //       // alert("哈哈 你被Ban掉了! 好爛");
              //       // alert(XMLHttpRequest.readyState);
              //       // alert(textStatus);
              //       // alert("超時請求")
              //     },
              //   });
              //   // event.preventDefault();
              //   return false;
              // });
              $(document).ready(function(){
                  $("#myTabContent").css("height",$('#information').height());
              });
              $(window).resize(function(){
                      $("#myTabContent").css("#information",$(window).height());
                  });
            </script>
            <!-- 曲線圖  -->
            <!-- <div id="morris-bar-chart" style="height:300px"></div> -->
            <!-- <div class="row" id='graph'>
              <div class="mt-3" id="chartContainer" style="height: 450px; width: 100%;"></div>
            <img id="loader"
              src="https://canvasjs.com/wp-content/uploads/images/gallery/javascript-stockcharts/overview/loading.gif"
              style="position: absolute; top: 150px; left: 48%; display: none" />
            </div> -->

            <!-- <div id="graph-container" >
                <div id="chartContainer" style="height: 450px; width: 100%;"></div>
                <img id="loader"
              src="https://canvasjs.com/wp-content/uploads/images/gallery/javascript-stockcharts/overview/loading.gif"
              style="position: absolute; top: 150px; left: 48%; display: none" /> 
              </div> -->
            <!-- 曲線圖  -->
          </div>
          <!-- <div class="col-12"> -->
            <!-- <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item">
                <a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
                  aria-selected="false">Today</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active show" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                  aria-controls="profile" aria-selected="true">This Week</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab"
                  aria-controls="contact" aria-selected="false">All</a>
              </li>
            </ul> -->
            <div class="tab-content " id="myTabContent" style="overflow-y: scroll;">
              <div class="tab-pane fade active show" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>編號</th>
                      <th class="text-center">網站</th>
                      <!-- <th>Time</th> -->
                      <th  class="text-center">相似度</th>
                      <th class="text-right">等級</th>
                    </tr>
                  </thead>
                  <tbody id="tableBody">
                   
                  </tbody>
                </table>

              </div>
             
            <!-- </div> -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var yearContent = '<label class="mb-1 mr-2" for="" style="display:block;">請輸入白名單網站</label>\
                        <div class="input-group mr-4 " style="">\
                          <div class="input-group-prepend">\
                            <span class="input-group-text" id="basic" style="background: #dee2e67a;"><li class="fas fa-list" aria-hidden="true"></li></span>\
                          </div>\
                          <input type="text" class="form-control date-own"  id="whiteList" name="whiteList" placeholder="白名單網站"\
                            aria-label="years" aria-describedby="basic" >\
                        </div>'

    // var monthContent = '<label class="mb-1 mr-2" for="" style="display:block;">請選擇年分與月份</label>\
    //                     <div class="input-group mr-4" style="width: 140px;">\
    //                       <div class="input-group-prepend">\
    //                         <span class="input-group-text" id="basic" style="background: #dee2e67a;"><li class="fa fa-calendar" aria-hidden="true"></li></span>\
    //                       </div>\
    //                       <input type="text" class="form-control date-own"  id="months" name="month_open" placeholder="----年--月"\
    //                         aria-label="years" aria-describedby="basic" required>\
    //                     </div>'
    var $j = jQuery.noConflict();
    $j("#select").on("change", function () {
      if ($('#select').val()) {
        $("#cal").html(yearContent);
        // $j('#years').datepicker({
        //   startView: "years",
        //   minViewMode: 2,
        //   format: 'yyyy',
        //   endDate: '+0d',
        //   autoclose: true,
        // });
      }
      // else if ($('#select').val() == 'month') {
      //   $("#cal").html(monthContent);
      //   $j('#months').datepicker({
      //     format: "yyyy-mm",
      //     viewMode: "months",
      //     minViewMode: "months",
      //     endDate: '+0d',
      //     autoclose: true,
      //   });
      //   // console.log("{{ open|escapejs}}");
      // }
    });
    // jsFunc({{ open|escapejs}});
  </script>


  <!-- Scripts -->
  <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
  </script> -->
  <!-- <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js" integrity="sha256-Lsk+CDPOzTapLoAzWW0G/WeQeViS3FMzywpzPZV8SXk=" crossorigin="anonymous"></script> -->
  <!-- <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script> -->
  <!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script> -->
  <!-- <script src="../static/assets/plugins/jquery/js/jquery.min.js"></script>
  <script src="../static/assets/plugins/jquery-scrollbar/js/jquery.scrollbar.min.js"></script> -->
  <!-- <script src="../static/assets/plugins/jquery-scrollbar/css/jquery.scrollbar.min.css"></script> -->
  <!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> -->
  <script src="../static/assets/js/vendor-all.min.js"></script>
  <script src="../static/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
  <script src="../static/assets/js/pcoded.min.js"></script>
  <!-- Custom Script -->
  <script src="../static/script.js"></script>
</body>

</html>